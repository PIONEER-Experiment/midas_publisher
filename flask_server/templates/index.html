<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Oscilloscope Plot</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/eventsource/1.0.6/eventsource.min.js"></script>
    <!-- Include the Plotly script from the CDN -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <h1>Oscilloscope Plot</h1>
    
    <!-- Display the event number -->
    <div>
        <h2>Event Number</h2>
        <div id="event-number">Loading...</div>
    </div>
    
    <!-- Display the plot -->
    <div id="plot-container"></div>
    
    <script>
        const rawData = document.getElementById('raw-data');
        const plotContainer = document.getElementById('plot-container');
        const eventNumber = document.getElementById('event-number');
        const eventSource = new EventSource('/stream');

        eventSource.addEventListener('event_update', (event) => {
            const eventData = JSON.parse(event.data);

            // Display the raw data as text
            //rawData.textContent = JSON.stringify(eventData, null, 2);

            if (eventData && eventData.data.event_number !== undefined) {
                // Update the event number
                eventNumber.textContent = `Event Number: ${eventData.data.event_number}`;
            }

            if (eventData && eventData.data.hodo_y_data) {
                // Update the plot
                const xValues = Array.from({ length: eventData.data.hodo_y_data.length }, (_, i) => i + 1);
                const plotData = {
                    x: xValues,
                    y: eventData.data.hodo_y_data,
                    mode: 'lines+markers',
                    type: 'scatter'
                };

                const layout = {
                    xaxis: { range: [1, xValues.length] }, // Set the x-axis range
                    yaxis: { range: [1500, 2000] } // Set the y-axis range
                };

                // Use Plotly to update the plot with the specified layout
                Plotly.newPlot(plotContainer, [plotData], layout);
            }
        });
    </script>
</body>
</html>
